---
title: "R Notebook"
---

```{r}
setwd("C:/Users/iris9/BioTrajX")
devtools::load_all() 
```

```{r}
library(Seurat)
seu <- readRDS("C:/Users/iris9/Desktop/GSE164690.all.CD8posT.wScores_pseudotime.rds")
expr <- as.matrix(GetAssayData(seu, layer = "data"))
t<- seu$monocle3_pseudotime
naive<- c("CCR7","TCF7","IL7R")
term<- c('PDCD1','LAG3','HAVCR2','TOX','TIGIT','CTLA4','CXCL13','ENTPD1','ITGAE')
cluster <- seu$functional.cluster

```

```{r}
DimPlot(seu, group.by = "functional.cluster")
FeaturePlot(seu, features="monocle3_pseudotime")
FeaturePlot(seu, features="slingshot_pseudotime")
FeaturePlot(seu, features="cytotrace_score")
```


```{r}
D <- metrics_D(expr, naive_markers = naive, terminal_markers = term, seu$monocle3_pseudotime)


plot_metrics_D(seu$monocle3_pseudotime,D)
```
```{r}
O <- metrics_O(expr, naive_markers = naive, terminal_markers = term, seu$monocle3_pseudotime)
plot_metrics_O(expr,pseudotime = seu$monocle3_pseudotime, O ,naive_markers = naive, terminal_markers = term)
```
```{r}
E <- metrics_E(seu$monocle3_pseudotime,
              naive_marker_scores = D$s_i_naive,
              terminal_marker_scores = D$s_i_term,
              method = c("gmm"))
plot_metrics_E(E)            
```


```{r}
res_single <- compute_single_DOE_linear(seu,
                    seu$slingshot_pseudotime,
                    naive_markers = naive,
                    terminal_markers = term)
```
```{r}
pseudotime_methods <- list(
  "monocle3" = seu$monocle3_pseudotime,
  "slingshot" = seu$slingshot_pseudotime, 
  "CytoTRACE" = seu$cytotrace_score
)

res<- compute_multi_DOE_linear(expr,
                          pseudotime_list = pseudotime_methods,
                          naive_markers = naive,
                          terminal_markers =term)
```
```{r}
plot.multi_doe_results(res, type = "bar")
```
```{r}
plot.multi_doe_results(res, type = "radar")
```

